#### Install

```bash
dotnet add package Microsoft.AspNetCore.Mvc.Versioning
dotnet add package Microsoft.AspNetCore.Mvc.Versioning.ApiExplorer
```

#### Move all controllers

In the subfolder `v1`

#### Add class

```bash
ConfigureSwaggerOptions.cs
```

#### Add in the `Program.cs`

```bash
//##############################################################
builder.Services.AddApiVersioning(opt =>
{
  opt.DefaultApiVersion =
    new Microsoft.AspNetCore.Mvc.ApiVersion(1, 0);
  opt.AssumeDefaultVersionWhenUnspecified = true;
  opt.ReportApiVersions = true;
  opt.ApiVersionReader = ApiVersionReader.Combine(
    new UrlSegmentApiVersionReader(),
    new HeaderApiVersionReader("x-api-version"),
    new MediaTypeApiVersionReader("x-api-version")
  );
});

builder.Services.AddVersionedApiExplorer(options =>
{
  options.GroupNameFormat = "'v'VVV";
  options.SubstituteApiVersionInUrl = true;
});

builder.Services.ConfigureOptions<ConfigureSwaggerOptions>();
```

#### Modify path in the default controller

```bash
  public string Template =>
    "api/v{version:apiVersion}/[controller]";
```

#### Update in `Program.cs`

```bash
app.UseSwaggerUI(options =>
{
  foreach (
    var description in apiVersionDescriptionProvider.ApiVersionDescriptions
  )
  {
    options.SwaggerEndpoint(
      $"/swagger/{description.GroupName}/swagger.json",
      description.GroupName.ToUpperInvariant()
    );
  }
});
```

#### Create Folders

```bash
./swagger-autogenerated/v1/
./swagger-autogenerated/v2/
```

#### Modify the project `*.csproj`

```bash
    <!-- auto generating json file on each build -->
    <Target Name="CreateSwaggerJson" AfterTargets="PostBuildEvent" Condition="'$(Configuration)' == 'SwaggerConfig'">
        <Exec Command="dotnet tool restore" />
        <Exec Command="dotnet swagger tofile --output ./swagger-autogenerated/v1/swagger.json $(OutputPath)$(AssemblyName).dll v1" WorkingDirectory="$(ProjectDir)" />
        <Exec Command="dotnet swagger tofile --output ./swagger-autogenerated/v2/swagger.json $(OutputPath)$(AssemblyName).dll v2" WorkingDirectory="$(ProjectDir)" />
    </Target>
```

#### How to add a new api version

 - Add into the `*.csproj`
 - Create a new `V3` folder in the controllers directory
 - Create a new `V3` folder in the swagger-autogenerated directory
 - In the controller specify the version

By default currently we are using version 1.0 (if nothing is specified)

In `Program.cs` it can be changed

```bash
  opt.DefaultApiVersion =
    new Microsoft.AspNetCore.Mvc.ApiVersion(1, 0);
```

We can extend old controllers - override methods

